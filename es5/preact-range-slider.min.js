!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact")):"function"==typeof define&&define.amd?define(["exports","preact"],t):t(e.PreactRangeSlider={},e.preact)}(this,function(e,E){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a,t,l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function P(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function i(e,t){var n=t.min,r=t.max;return e<=n?n:r<=e?r:e}function s(e,t){var n=t.min,r=t.max;return e<n||r<e}function o(e,t,n){var r=t.allowCross,o=n.handle,a=n.bounds;if(!r&&null!=o){if(0<o&&e<=a[o-1])return a[o-1];if(o<a.length-1&&e>=a[o+1])return a[o+1]}return e}function c(e,t){var n=t.step,r=function(t,e){var n=e.marks,r=e.step,o=e.min,a=Object.keys(n).map(Number);if(null!=r&&0<r){var i=Math.round((t-o)/r)*r+o;a.push(i)}var s=a.map(function(e){return Math.abs(t-e)});return a[s.indexOf(Math.min.apply(Math,s))]||o}(e,t);return null==n||n<=0?r:Number(r.toFixed(function(e){var t=e.toString(),n=t.indexOf("."),r=0;return-1!==n&&(r=t.length-n-1),r}(n)))}function u(e,t){var n=t.getBoundingClientRect();return e?n.top+n.height/2:n.left+n.width/2}function d(e,t){return e?t.clientY:t.pageX}function h(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function p(t,e){return e.some(function(e){return t.target===e})}function f(e){return 1<e.touches.length||"touchend"===e.type.toLowerCase()&&0<e.touches.length}function v(e){e.stopPropagation(),e.preventDefault()}function B(e,t){for(var n=[],r=Object.keys(e),o=0,a=r.length;o<a;o++){var i=r[o];e[i]&&n.push(i)}return t&&(n=t.concat(n)),n.join(" ")}function C(e){var a=e.min,t=e.max,i=e.lowerBound,s=e.upperBound,u=e.marks,l=e.included,c=e.vertical,d=e.classesPrefix,n=Object.keys(u),h=.9*(100/(n.length-1)),p=t-a,r=n.map(Number).sort(function(e,t){return e-t}).map(function(e){var t,n=B(((t={})[d+"active"]=!l&&e===s||l&&e<=s&&i<=e,t),[d+"text"]),r=c?{marginBottom:"-50%",bottom:(e-a)/p*100+"%"}:{width:h+"%",marginLeft:-h/2+"%",left:(e-a)/p*100+"%"},o=u[e];return E.h("span",{class:n,style:r,key:String(e)},o)});return E.h("div",{class:d+"marks"},r)}function O(e){var a=e.min,t=e.max,n=e.step,i=e.lowerBound,s=e.upperBound,r=e.marks,o=e.dots,u=e.included,l=e.vertical,c=e.classesPrefix,d=t-a,h=function(e,t,n,r,o){var a=Object.keys(e).map(Number);if(t&&0<n)for(var i=r;i<=o;i+=n)-1===a.indexOf(i)&&a.push(i);return a}(r,o,n,a,t).map(function(e){var t,n=Math.abs(e-a)/d*100+"%",r=l?{bottom:n}:{left:n},o=B(((t={})[c+"active"]=!u&&e===s||u&&e<=s&&i<=e,t),[c+"dot"]);return E.h("span",{class:o,style:r,key:String(e)})});return E.h("div",{class:c+"steps"},h)}(t=a||(a={}))[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT",t[t.BACK=3]="BACK",t[t.FORWARD=4]="FORWARD";var m=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.dragOffset=0,o.handlesRefs=[],o.calcMinValue=function(e,t){return t&&e<t?t:e},o.calcMaxValue=function(e,t){return t&&t<e?t:e},o.saveSlider=function(e){o.sliderRef=e},o.saveHandle=function(e,t){void 0===t&&(t=0),null==e||void 0===e.base?delete o.handlesRefs[t]:o.handlesRefs[t]=e.base},o.onMouseDown=function(e){if(e.button===a.LEFT){var t=o.props.vertical,n=d(t,e);if(p(e,o.handlesRefs)){var r=u(t,e.target);o.dragOffset=n-r,n=r}else o.dragOffset=0;o.onStart(n),o.addDocumentMouseEvents(),v(e)}},o.onTouchStart=function(e){if(!f(e)){var t=o.props.vertical,n=h(t,e);if(p(e,o.handlesRefs)){var r=u(t,e.target);o.dragOffset=n-r,n=r}else o.dragOffset=0;o.onStart(n),o.addDocumentTouchEvents(),v(e)}},o.onMouseMove=function(e){if(o.sliderRef){var t=d(o.props.vertical,e);o.onMove(t-o.dragOffset),v(e)}else o.onEnd()},o.onTouchMove=function(e){if(o.sliderRef&&!f(e)){var t=h(o.props.vertical,e);o.onMove(t-o.dragOffset),v(e)}else o.onEnd()},o.onEventEnd=function(){o.removeDocumentEvents(),o.onEnd(),o.props.onAfterChange(o.getValue())},o}return n(t,e),t.prototype.componentWillUnmount=function(){this.removeDocumentEvents()},t.prototype.renderBase=function(e,t){var n,r,o,a=this.props,i=a.min,s=a.max,u=a.step,l=a.marks,c=a.dots,d=a.included,h=a.vertical,p=a.disabled,f=a.className,v=a.classesPrefix,m=a.children,g=a.minSeekable,y=a.maxSeekable,b=this.getLowerBound(),x=this.getUpperBound(),S=B(((n={})[v+"with-marks"]=Object.keys(l).length,n[v+"vertical"]=h,n[v+"disabled"]=p,n[v+"minSeekable"]=g&&i<g,n[v+"maxSeekable"]=y&&y<s,n),[f]),M=this.calcMaxValue(s,y),k=this.calcMinValue(i,g);return E.h("div",{class:"slider-container"},E.h("div",{class:S,ref:this.saveSlider,onTouchStart:p?P:this.onTouchStart,onMouseDown:p?P:this.onMouseDown,style:(r=g&&i<g?g/s*100:0,o=y&&y<s?(s-y)/s*100:0,{margin:"0 "+o+"% 0 "+r+"%",width:100-(o+r)+"%"})},E.h("div",{class:v+"rail"}),e,E.h(O,{vertical:h,marks:l,dots:c,step:u,included:d,lowerBound:b,upperBound:x,max:M,min:k,classesPrefix:v}),t,E.h(C,{vertical:h,marks:l,included:d,lowerBound:b,upperBound:x,max:M,min:k,classesPrefix:v}),m))},t.prototype.getSliderStart=function(){var e=this.sliderRef;if(!e)return 0;var t=e.getBoundingClientRect();return this.props.vertical?t.top:t.left},t.prototype.getSliderLength=function(){var e=this.sliderRef;return e?this.props.vertical?e.clientHeight:e.clientWidth:0},t.prototype.calcValue=function(e){var t=this.props,n=t.vertical,r=t.min,o=t.max,a=t.minSeekable,i=t.maxSeekable,s=this.calcMinValue(r,a),u=this.calcMaxValue(o,i),l=Math.abs(Math.max(e,0)/this.getSliderLength()),c=n?(1-l)*(u-s)+s:l*(u-s)+s;return i?c<=i?c:i:c},t.prototype.calcValueByPos=function(e){var t=e-this.getSliderStart();return this.clampAlignValue(this.calcValue(t))},t.prototype.calcOffset=function(e){var t=this.props,n=t.min,r=t.max,o=t.minSeekable,a=t.maxSeekable,i=this.calcMinValue(n,o);return 100*((e-i)/(this.calcMaxValue(r,a)-i))},t.prototype.addDocumentMouseEvents=function(){document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onEventEnd)},t.prototype.addDocumentTouchEvents=function(){document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",this.onEventEnd)},t.prototype.removeDocumentEvents=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onEventEnd),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onEventEnd)},t.defaultProps={min:0,max:100,step:1,marks:{},dots:!1,included:!0,vertical:!1,disabled:!1,className:"range-slider",classesPrefix:"",onBeforeChange:P,onChange:P,onAfterChange:P,tipFormatter:String,minSeekable:void 0,maxSeekable:void 0},t.getDerivedStateFromProps=function(e,t){return{}},t}(E.Component),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.saveElement=function(e){t.elementRef=e},t}return n(t,e),t.prototype.render=function(e){var t,n=e.min,r=e.max,o=e.value,a=e.vertical,i=e.disabled,s=e.dragging,u=e.index,l=e.offset,c=e.classesPrefix,d=e.children,h=a?{bottom:l+"%"}:{left:l+"%"};s&&this.elementRef&&this.elementRef.focus();var p=B(((t={})[c+"dragging"]=s,t),[c+"handle",c+"handle-"+u]);return E.h("div",{class:p,style:h,role:"slider",tabIndex:i?void 0:0,"aria-orientation":a?"vertical":"horizontal","aria-disabled":String(i),"aria-valuemin":n,"aria-valuemax":r,"aria-valuenow":o,ref:this.saveElement},E.h("span",{class:c+"tip"},d))},t}(E.Component),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.render=function(e){var t=e.vertical,n=e.included,r=e.index,o=e.offset,a=e.length,i=e.classesPrefix,s={};return n||(s.visibility="hidden"),t?(s.bottom=o+"%",s.height=a+"%"):(s.left=o+"%",s.width=a+"%"),E.h("div",{class:i+"track "+i+"track-"+r,style:s})},t}(E.Component),b=function(r){function e(e){var t=r.call(this,e)||this,n=null!=e.value?e.value:null!=e.defaultValue?e.defaultValue:e.min;return t.state={dragging:!1,value:t.clampAlignValue(n)},t}return n(e,r),e.prototype.render=function(e,t){var n=e.min,r=e.max,o=e.vertical,a=e.included,i=e.disabled,s=e.classesPrefix,u=e.tipFormatter,l=t.value,c=t.dragging,d=this.calcOffset(l),h=E.h(g,{vertical:o,disabled:i,dragging:c,min:n,max:r,value:l,index:1,offset:d,classesPrefix:s,ref:this.saveHandle,key:"handle-0"},u(l)),p=E.h(y,{vertical:o,included:a,index:1,offset:0,length:d,classesPrefix:s,key:"track-0"});return this.renderBase(p,h)},e.prototype.getValue=function(){return this.state.value},e.prototype.getLowerBound=function(){return this.props.min},e.prototype.getUpperBound=function(){return this.state.value},e.prototype.onChange=function(e){var t=this,n=this.props;"value"in n&&void 0!==e.value?n.onChange(e.value):this.setState(e,function(){return n.onChange(t.state.value)})},e.prototype.onStart=function(e){this.setState({dragging:!0});var t=this.getValue();this.props.onBeforeChange(t);var n=this.calcValueByPos(e);n!==t&&this.onChange({value:n})},e.prototype.onMove=function(e){var t=this.calcValueByPos(e);t!==this.state.value&&this.onChange({value:t})},e.prototype.onEnd=function(){this.setState({dragging:!1})},e.prototype.clampAlignValue=function(e,t){void 0===t&&(t={});var n=l({},this.props,t);return c(i(e,n),n)},e.getDerivedStateFromProps=function(e,t){if(!("value"in e||"min"in e||"max"in e))return{};var n=t.value,r=null==e.value?n:e.value,o=c(i(r,e),e);return o===n?{}:(s(r,e)&&e.onChange(o),{value:o})},e}(m),x=function(u){function e(e){var t=u.call(this,e)||this,n=e.count,r=e.min,o=e.max,a=Array(n+1).slice().map(function(){return r}),i=(null!=e.value?e.value:null!=e.defaultValue?e.defaultValue:a).map(function(e){return t.clampAlignValue(e)}),s=i[0]===o?0:i.length-1;return t.state={handle:null,recent:s,bounds:i},t}return n(e,u),e.prototype.render=function(e,t){var n=this,r=e.min,o=e.max,a=e.vertical,i=e.included,s=e.disabled,u=e.classesPrefix,l=e.tipFormatter,c=t.handle,d=t.bounds,h=d.map(function(e){return n.calcOffset(e)}),p=d.map(function(e,t){return E.h(g,{vertical:a,disabled:s,dragging:c===t,min:r,max:o,value:e,index:t+1,offset:h[t],classesPrefix:u,ref:function(e){return n.saveHandle(e,t)},key:"handle-"+t},l(e))}),f=d.slice(0,-1).map(function(e,t){var n=t+1;return E.h(y,{vertical:a,included:i,index:n,offset:h[t],length:h[n]-h[t],classesPrefix:u,key:"track-"+t})});return this.renderBase(f,p)},e.prototype.getValue=function(){return this.state.bounds},e.prototype.getLowerBound=function(){return this.state.bounds[0]},e.prototype.getUpperBound=function(){var e=this.state.bounds;return e[e.length-1]},e.prototype.onChange=function(e){var t=this.props;!("value"in t)?this.setState(e):void 0!==e.handle&&this.setState({handle:e.handle});var n=l({},this.state,e);t.onChange(n.bounds)},e.prototype.onStart=function(e){var t=this.props,n=this.state,r=this.getValue();t.onBeforeChange(r);var o=this.calcValueByPos(e),a=this.getClosestBound(o),i=this.getBoundNeedMoving(o,a);if(this.setState({handle:i,recent:i}),o!==r[i]){var s=n.bounds.slice();s[i]=o,this.onChange({bounds:s})}},e.prototype.onMove=function(e){var t=this.props,n=this.state;if(null!=n.handle){var r=this.calcValueByPos(e);if(r!==n.bounds[n.handle]){var o=n.bounds.slice();o[n.handle]=r;var a=n.handle;if(!1!==t.pushable){var i=n.bounds[a];this.pushSurroundingHandles(o,a,i)}else t.allowCross&&(o.sort(function(e,t){return e-t}),a=o.indexOf(r));this.onChange({handle:a,bounds:o})}}},e.prototype.onEnd=function(){this.setState({handle:null})},e.prototype.clampAlignValue=function(e,t){void 0===t&&(t={});var n=l({},this.props,t);return c(this.clampValueToSurroundingHandles(i(e,n),n),n)},e.prototype.getClosestBound=function(e){for(var t=this.state.bounds,n=0,r=1,o=t.length-1;r<o;r++)e>t[r]&&(n=r);return Math.abs(t[n+1]-e)<Math.abs(t[n]-e)&&(n+=1),n},e.prototype.getBoundNeedMoving=function(e,t){var n=this.state,r=n.bounds,o=n.recent,a=t,i=t+1;return r[i]===r[t]&&(a=r[o]===r[t]?o:i,e!==r[i]&&(a=e<r[i]?t:i)),a},e.prototype.pushSurroundingHandles=function(e,t,n){var r=Number(this.props.pushable),o=e[t],a=0;if(e[t+1]-o<r&&(a=1),o-e[t-1]<r&&(a=-1),0!==a){var i=t+a,s=a*(e[i]-o);this.pushHandle(e,i,a,r-s)||(e[t]=n)}},e.prototype.pushHandle=function(e,t,n,r){for(var o=e[t],a=e[t];n*(a-o)<r;){if(!this.pushHandleOnePoint(e,t,n))return e[t]=o,!1;a=e[t]}return!0},e.prototype.pushHandleOnePoint=function(e,t,n){var r=this.getPoints(),o=r.indexOf(e[t])+n;if(o>=r.length||o<0)return!1;var a=t+n,i=r[o],s=Number(this.props.pushable),u=n*(e[a]-i);return!!this.pushHandle(e,a,n,s-u)&&(e[t]=i,!0)},e.prototype.getPoints=function(){var e=this.props,t=e.marks,n=e.step,r=e.min,o=e.max,a=this.pointsCache;if(!a||a.marks!==t||a.step!==n){var i=l({},t);if(null!=n&&0<n)for(var s=r;s<=o;s+=n)i[s]=String(s);var u=Object.keys(i).map(Number);u.sort(function(e,t){return e-t}),this.pointsCache={marks:t,step:n,points:u}}return this.pointsCache.points},e.prototype.clampValueToSurroundingHandles=function(e,t){return o(e,t,this.state)},e.defaultProps=l({},m.defaultProps,{count:1,allowCross:!0,pushable:!1}),e.getDerivedStateFromProps=function(t,n){if(!("value"in t||"min"in t||"max"in t))return{};var r=n.bounds,e=(t.value||r).map(function(e){return c(o(i(e,t),t,n),t)});return e.length===r.length&&e.every(function(e,t){return e===r[t]})?{}:(r.some(function(e){return s(e,t)})&&t.onChange(e),{bounds:e})},e}(m);e.Slider=b,e.MultiSlider=x,Object.defineProperty(e,"__esModule",{value:!0})});